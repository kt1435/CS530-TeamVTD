<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js">
</script>

<!-- Access jQuery Library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">

//declare namespace
    var ctfastrak = {};
 
    //declare map
    var map;

    var infowindow = new google.maps.InfoWindow();

    var xhr = new XMLHttpRequest();


      //trace function for debugging
        function trace(message)
        {
            if (typeof console != 'undefined')
            {
            console.log(message);
            }
        }




    //Function to create marker
    ctfastrak.createMarker = function(latitude,longitude,title)
    {
      var markerLatLng = new google.maps.LatLng(latitude,longitude);
      var marker = new google.maps.Marker({
        position: markerLatLng,
        map: map,
        title: title
      });

      google.maps.event.addListener(marker, 'click', function() {
    //add contentString using this syntax
    infowindow.setContent(contentString);
    infowindow.open(map,marker);
  });

    }


 
    //Function that gets run when the document loads
    ctfastrak.initialize = function()
    {
      var latlng = new google.maps.LatLng(41.76570112356035, -72.68008694999997);
      var myOptions = {
        zoom: 12,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    

    ctfastrak.createMarker(41.76570112356035, -72.68008694999997,'Hartford');
    
    //New Britain Station
    ctfastrak.createMarker(41.668601, -72.77897300000001,'New Britain Station'); 

    //Bristol
    ctfastrak.createMarker(41.681612106191125, -72.94096145000003,'Bristol');

    //New Britain
    ctfastrak.createMarker(41.68048154735063, -72.78714150000002,'New Britain');  

    //Manchester Community College
    ctfastrak.createMarker(41.7611547, -72.56336809999999,'Manchester Community College'); 

    //UCONN Health Center 
    ctfastrak.createMarker(41.730228, -72.79154770000002,'UCONN Health Center');  

    //Westfarms
    ctfastrak.createMarker(41.72492099999999, -72.76144999999997,'Westfarms'); 

    //Stanley Street
    ctfastrak.createMarker(41.6825307, -72.7677759,'Stanley Street');
    
    }
/////////////////////////////////////////////

  function showCtfastraksInfo(ctfastraks) {

    //ctfastrakbusCount = ctfastraks.items.length;

    var message = "<h3>" + ctfastraks.header + "</h3>" +
                          "On " + ctfastraks.timestamp +
                    " we'll run " + ctfastrakbusCount + " ctfastrak.";

    locationUI.innerHTML = message + locationUI.innerHTML;
    resizeMapLink.style.visibility = "visible";

    createCtfastrakMap(ctfastraks);
}

            function loadCtfastrakData(dataUrl) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", dataUrl);


                xhr.onreadystatechange = function() {

                    if (xhr.readyState == 4) {
          if ((xhr.status >= 200 && xhr.status < 300) ||
                                    xhr.status === 304) {
        var jsonData = xhr.responseText;
        
        var ctfastraksData = JSON.parse(jsonData).ctfastraks;

        showCtfastraksInfo(ctfastraksData);

        } else {
        console.log(xhr.statusText);

           tempContainer.innerHTML += '<p class="error">Error getting ' +
                 target.name + ": "+ xhr.statusText +
                 ",code: "+ xhr.status + "</p>";
     }
    }
 }
 xhr.send();
                
}


var dataUrl = 'http://65.213.12.244/realtimefeed/externalfeed/trapezerealtimefeed.json';
loadCtfastrakData(dataUrl);

/////////////////////////////////////////
    ctfastrak.getBusRoutes = function()
    {
  $.getJSON('http://65.213.12.244/realtimefeed/tripupdate/tripupdates.json', function(data)
  {
    $.each(data.items, function(i,item){
      trace(item.display_name);
      //add bus stops to the side panel
      $('#stoplist').append(item.display_name + '<br>');
    });
  });
}



 
</script>
</head>
<body onload="ctfastrak.initialize()" "xhr.onload">
  <!-- side panel div container -->
    <div id="toc" style="position:absolute; width:380px; height: 100%; overflow:auto; float:left; padding-left:10px; padding-right:10px;">
      <h1 id="title">CTfastrak: Where's that bus?</h1>
    </div>
    <!-- map div container -->
    <div id="map_canvas" style="height:100%; margin-left:400px;"></div>
</body>
</html>
